record(calcout, "$(HUTCH):LENS:STK:$(MOTBASE):UNLOCKED) {
    field(DESC, "Remove all lenses")
    field(PINI, "NO")
    field(INPA, "$(HUTCH):LENS:STK:$(MOTBASE):LOCKED")
    field(CALC, "A=1?C:0")
    field(OOPT, "When Non-Zero")
    field(DOPT, "1")
    field(OUT,  "$(Y_MOT):OUT:GO")
}

record(bo, $(HUTCH):LENS:STK:$(MOTBASE):OUT:GO) {
    field(DTYP, "Raw Soft Channel")
    field(DESC, "Put lens in the beam")
    field(PINI, "NO")
    field(OUT,  "$(HUTCH):LENS:STK:$(MOTBASE):UNLOCKED.C")
}

record(longin, $(HUTCH):LENS:STK:$(MOTBASE):NLENS) {
    field(DTYP, "Raw Soft Channel")
    field(PINI, "YES")
    field(DESC, "Number of lenses on the stack")
    field(INP,  "3")
}

record(calc, $(HUTCH):LENS:STK:$(MOTBASE):LOCKED) {
    field(DESC, "Whether a lens is locked in")
    field(SCAN, "Passive")
    field(PINI, "YES")
    field(INPA, "$(HUTCH):LENS:$(LENS1_ID):LOCK_IN")
    field(INPB, "$(HUTCH):LENS:$(LENS2_ID):LOCK_IN")
    field(INPC, "$(HUTCH):LENS:$(LENS3_ID):LOCK_IN")
    field(CALC, "A+B+C=0?1:0)
}

record(calc, $(HUTCH):LENS:STK:$(MOTBASE):MOV) {
    field(DESC, "
record(calc, $(HUTCH):LENS:STK:$(MOTBASE):STATE_CALC) {
    field(SCAN, "Passive")
    field(PINI, "YES")
    field(INPA, "$(Y_MOT)")
    field(INPB, "$(HUTCH):LENS:STK:$(MOTBASE):LOCKED")
    field(CALC, "A+B=0?0:B+1)
}

record(mbbi, $(HUTCH):LENS:STK:$(MOTBASE):STATE) {
    field(DESC, "Current state of Lens")
    field(INP,  "$(HUTCH):LENS:STK:$(MOTBASE):STATE_CALC")
    field(PINI, "YES")
    field(ZRVL, "0")
    field(ONVL, "1")
    field(TWVL, "2")
    field(ZRST, "OK")
    field(ONST, "ERROR")
    field(TWST, "LOCKED")
} 
